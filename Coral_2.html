echo "# CoralES" >> README.md
git init
git add README.md
git commit -m "first commit"
git branch -M main
git remote add origin https://github.com/eliyasul/CoralES.git
git push -u origin main

<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>注专转 专 专祝 拽爪注转 -  转 转</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.1.0"></script>
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; background-color: #f0f2f5; padding: 15px; margin: 0; }
        .container { max-width: 1100px; margin: auto; padding-top: 75px; }
        
        .sticky-header { 
            position: fixed; top: 0; left: 0; right: 0; 
            background: #fff; z-index: 1000; 
            padding: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .tab-menu { display: flex; gap: 8px; max-width: 1100px; margin: auto; overflow-x: auto; }
        .tab-btn { flex: 1; padding: 10px; background: #eee; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; white-space: nowrap; }
        .tab-btn.active { background: #1a73e8; color: white; }

        .card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 12px; margin-bottom: 12px; }
        .input-group { display: flex; flex-direction: column; }
        .input-group label { font-size: 0.8rem; font-weight: bold; margin-bottom: 3px; color: #444; }
        
        input { padding: 10px; border-radius: 6px; border: 1px solid #ccc; font-size: 14px; }
        .save-btn { background: #28a745; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; }
        
        /* 转 转 */
        .table-wrapper { overflow-x: auto; margin-top: 10px; border-radius: 8px; border: 1px solid #eee; }
        table { width: 100%; border-collapse: collapse; min-width: 800px; font-size: 0.85rem; }
        th, td { padding: 10px; text-align: center; border-bottom: 1px solid #eee; }
        th { background-color: #f8f9fa; color: #555; position: sticky; top: 0; }
        tr:hover { background-color: #fcfcfc; }

        /* 注爪 专驻 */
        .charts-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; }
        .chart-card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); height: 280px; }
        .chart-card h3 { margin: 0 0 10px 0; font-size: 0.95rem; color: #1a73e8; text-align: center; }
        canvas { width: 100% !important; height: 200px !important; }

        .event-item { background: #fff3cd; padding: 8px; border-radius: 6px; margin-bottom: 5px; display: flex; justify-content: space-between; font-size: 0.85rem; }
        .photo-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .photo-item img { width: 100%; border-radius: 8px; aspect-ratio: 1; object-fit: cover; }
        .del-btn { background: #ff4d4d; color: white; border: none; padding: 3px 7px; border-radius: 4px; cursor: pointer; }

        /* 爪注  */
        .in-range { background: #e6ffed !important; }
        .out-of-range { background: #ffdce0 !important; }
        .td-bad { color: #d93025; font-weight: bold; background-color: #fce8e6; }
        .td-good { color: #188038; font-weight: bold; background-color: #e6ffed; }
    </style>
</head>
<body>

<div class="sticky-header">
    <div class="tab-menu">
        <button class="tab-btn active" onclick="switchSystem('注专转 1', this)">注专转 1</button>
        <button class="tab-btn" onclick="switchSystem('注专转 2', this)">注专转 2</button>
        <button class="tab-btn" onclick="switchSystem('注专转 3', this)">注专转 3</button>
        <button class="tab-btn" onclick="switchSystem('注专转 4', this)">注专转 4</button>
    </div>
</div>

<div class="container">
    <h1 id="appTitle" contenteditable="true" onblur="saveTitle()" style="text-align:center; color:#1a73e8; font-size:1.5rem;"> 砖</h1>

    <div class="card">
        <h2>И 转 转 - <span id="currentSysName">注专转 1</span></h2>
        <div class="input-group" style="margin-bottom:15px;"><label>转专</label><input type="date" id="logDate" onchange="loadData()"></div>
        
        <div class="grid">
            <div class="input-group"><label>转 (33.5-37.5)</label><input type="number" id="vSal" step="0.1" oninput="val(this,33.5,37.5)"></div>
            <div class="input-group"><label>驻' (23.5-26.5)</label><input type="number" id="vTemp" step="0.1" oninput="val(this,23.5,26.5)"></div>
            <div class="input-group"><label>pH (7.5-8.9)</label><input type="number" id="vPH" step="0.01" oninput="val(this,7.5,8.9)"></div>
        </div>
        <div class="grid">
            <div class="input-group"><label></label><input type="number" id="vMg"></div>
            <div class="input-group"><label>拽转</label><input type="number" id="vAlk" step="0.1"></div>
            <div class="input-group"><label>拽爪</label><input type="number" id="vCa"></div>
            <div class="input-group"><label>专</label><input type="number" id="vNO2" step="0.01"></div>
            <div class="input-group"><label>专</label><input type="number" id="vNO3" step="0.1"></div>
            <div class="input-group"><label>驻住驻</label><input type="number" id="vPO4" step="0.01"></div>
        </div>
        <button class="save-btn" onclick="saveAll()">砖专  </button>
    </div>

    <div class="card">
        <h2> 住专转 转 ()</h2>
        <div class="table-wrapper">
            <table id="dataTable">
                <thead>
                    <tr>
                        <th>转专</th>
                        <th>转</th>
                        <th>驻'</th>
                        <th>pH</th>
                        <th>Mg</th>
                        <th>Alk</th>
                        <th>Ca</th>
                        <th>NO2</th>
                        <th>NO3</th>
                        <th>PO4</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    </tbody>
            </table>
        </div>
    </div>

    <div class="card">
        <h2> 专注 砖</h2>
        <div style="display:flex; gap:10px;">
            <input type="text" id="evText" style="flex:1" placeholder="转专 专注...">
            <button onclick="addEv()" style="padding:10px 20px; background:#1a73e8; color:white; border:none; border-radius:8px;">住祝</button>
        </div>
        <div id="evList" style="margin-top:10px;"></div>
    </div>

    <h2 style="padding-right:15px;"> 专驻 驻专</h2>
    <div class="charts-container">
        <div class="chart-card"><h3>转</h3><canvas id="cSal"></canvas></div>
        <div class="chart-card"><h3>驻专专</h3><canvas id="cTemp"></canvas></div>
        <div class="chart-card"><h3>pH</h3><canvas id="cPH"></canvas></div>
        <div class="chart-card"><h3></h3><canvas id="cMg"></canvas></div>
        <div class="chart-card"><h3>拽转</h3><canvas id="cAlk"></canvas></div>
        <div class="chart-card"><h3>拽爪</h3><canvas id="cCa"></canvas></div>
        <div class="chart-card"><h3>专</h3><canvas id="cNO2"></canvas></div>
        <div class="chart-card"><h3>专</h3><canvas id="cNO3"></canvas></div>
        <div class="chart-card"><h3>驻住驻</h3><canvas id="cPO4"></canvas></div>
    </div>

    <div class="card" style="margin-top:20px;">
        <h2> 专</h2>
        <input type="file" accept="image/*" capture="environment" onchange="upImg(event)">
        <div class="photo-grid" id="pGal" style="margin-top:10px;"></div>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('coralDB_v7')) || { title:" 砖", logs:[], events:[], photos:[] };
    let curSys = '注专转 1';
    let charts = {};

    document.getElementById('appTitle').innerText = db.title;
    document.getElementById('logDate').valueAsDate = new Date();

    function saveTitle() { db.title = document.getElementById('appTitle').innerText; sync(); }

    function val(el, min, max) {
        let v = parseFloat(el.value);
        el.className = isNaN(v) ? "" : (v >= min && v <= max ? "in-range" : "out-of-range");
    }

    function switchSystem(sys, btn) {
        curSys = sys;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('currentSysName').innerText = sys;
        loadData();
        render();
    }

    function loadData() {
        let d = document.getElementById('logDate').value;
        //  转 转  ( 砖注) 转爪 砖转
        let daily = db.logs.find(l => l.sys === curSys && l.date === d) || {};
        const fields = ['Sal','Temp','PH','Mg','Alk','Ca','NO2','NO3','PO4'];
        fields.forEach(f => {
            let el = document.getElementById('v'+f);
            el.value = daily[f] || '';
            if(f==='Sal') val(el,33.5,37.5);
            if(f==='Temp') val(el,23.5,26.5);
            if(f==='PH') val(el,7.5,8.9);
        });
    }

    function saveAll() {
        let d = document.getElementById('logDate').value;
        db.logs = db.logs.filter(l => !(l.sys === curSys && l.date === d));
        let entry = { sys: curSys, date: d };
        ['Sal','Temp','PH','Mg','Alk','Ca','NO2','NO3','PO4'].forEach(f => entry[f] = document.getElementById('v'+f).value);
        db.logs.push(entry);
        sync(); render();
        alert("砖专 爪!");
    }

    function sync() { localStorage.setItem('coralDB_v7', JSON.stringify(db)); }

    function renderTable() {
        let logs = db.logs.filter(l => l.sys === curSys).sort((a,b)=>new Date(b.date)-new Date(a.date));
        const check = (v, min, max) => {
            if(!v) return "";
            let n = parseFloat(v);
            return (n >= min && n <= max) ? "td-good" : "td-bad";
        };

        document.getElementById('tableBody').innerHTML = logs.map(l => `
            <tr>
                <td><b>${l.date}</b></td>
                <td class="${check(l.Sal, 33.5, 37.5)}">${l.Sal || '-'}</td>
                <td class="${check(l.Temp, 23.5, 26.5)}">${l.Temp || '-'}</td>
                <td class="${check(l.PH, 7.5, 8.9)}">${l.PH || '-'}</td>
                <td>${l.Mg || '-'}</td>
                <td>${l.Alk || '-'}</td>
                <td>${l.Ca || '-'}</td>
                <td>${l.NO2 || '-'}</td>
                <td>${l.NO3 || '-'}</td>
                <td>${l.PO4 || '-'}</td>
            </tr>
        `).join('');
    }

    function render() {
        renderTable();
        // 专注
        document.getElementById('evList').innerHTML = db.events.filter(e => e.sys === curSys).map(e => `
            <div class="event-item"><span><b>${e.date}</b>: ${e.text}</span><button class="del-btn" onclick="delEv(${e.id})">X</button></div>
        `).join('');
        // 专
        document.getElementById('pGal').innerHTML = db.photos.filter(p => p.sys === curSys).map(p => `
            <div style="position:relative"><button class="del-btn" style="position:absolute;top:2px;left:2px" onclick="delPh(${p.id})">X</button><img src="${p.src}"></div>
        `).join('');
        updateCharts();
    }

    function updateCharts() {
        let logs = db.logs.filter(l => l.sys === curSys).sort((a,b)=>new Date(a.date)-new Date(b.date));
        let labels = logs.map(l => l.date);
        let events = db.events.filter(e => e.sys === curSys);

        const ann = events.map(e => ({
            type: 'line', xMin: e.date, xMax: e.date, borderColor: '#ff4d4d', borderWidth: 3,
            label: {
                display: true, backgroundColor: 'rgba(255,77,77,0.8)', color: '#fff', font: {size: 10},
                content: e.text.length > 15 ? e.text.substring(0,15) + '...' : e.text,
                enter: (ctx) => { ctx.element.options.label.content = e.text; ctx.chart.draw(); },
                leave: (ctx) => { ctx.element.options.label.content = e.text.length > 15 ? e.text.substring(0,15) + '...' : e.text; ctx.chart.draw(); }
            }
        }));

        const build = (id, label, key, color, range=null) => {
            if(charts[id]) charts[id].destroy();
            let data = logs.map(l => l[key]);
            let boxes = range ? [{ type:'box', yMin:range.min, yMax:range.max, backgroundColor:'rgba(40,167,69,0.1)', borderWidth:0 }] : [];
            charts[id] = new Chart(document.getElementById(id).getContext('2d'), {
                type: 'line',
                data: { labels, datasets: [{ label, data, borderColor: color, tension:0.3, spanGaps:true }] },
                options: { 
                    responsive: true, maintainAspectRatio: false,
                    plugins: { annotation: { annotations: [...ann, ...boxes] } },
                    scales: { y: { beginAtZero: false } }
                }
            });
        };

        build('cSal', '转', 'Sal', '#1a73e8', {min:33.5, max:37.5});
        build('cTemp', '驻专专', 'Temp', '#fabb05', {min:23.5, max:26.5});
        build('cPH', 'pH', 'PH', '#1abc9c', {min:7.5, max:8.9});
        build('cMg', '', 'Mg', '#7b1fa2');
        build('cAlk', '拽转', 'Alk', '#c2185b');
        build('cCa', '拽爪', 'Ca', '#00796b');
        build('cNO2', '专', 'NO2', '#e67e22');
        build('cNO3', '专', 'NO3', '#d35400');
        build('cPO4', '驻住驻', 'PO4', '#2c3e50');
    }

    function addEv() {
        let t = document.getElementById('evText').value;
        let d = document.getElementById('logDate').value;
        if(!t) return;
        db.events.push({ id:Date.now(), sys:curSys, date:d, text:t });
        document.getElementById('evText').value = '';
        sync(); render();
    }
    function delEv(id) { db.events = db.events.filter(e=>e.id!==id); sync(); render(); }
    function delPh(id) { db.photos = db.photos.filter(p=>p.id!==id); sync(); render(); }
    function upImg(e) {
        let f = e.target.files[0];
        let r = new FileReader();
        r.onload = function(ev) {
            let img = new Image(); img.src = ev.target.result;
            img.onload = function() {
                let c = document.createElement('canvas');
                let s = 400 / img.width; c.width = 400; c.height = img.height * s;
                c.getContext('2d').drawImage(img,0,0,c.width,c.height);
                db.photos.push({id:Date.now(), sys:curSys, src:c.toDataURL('image/jpeg',0.7)});
                sync(); render();
            }
        };
        r.readAsDataURL(f);
    }

    loadData(); render();
</script>

</body>
</html>